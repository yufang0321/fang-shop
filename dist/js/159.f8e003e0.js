"use strict";(self["webpackChunkfang_shop"]=self["webpackChunkfang_shop"]||[]).push([[159],{1159:function(t,o,l){l.r(o),l.d(o,{default:function(){return N}});var s=l(3396),a=l(7139),e=l(9242);const n={class:"container"},i={class:"row mt-4"},d={class:"col-md-7"},u={class:"table align-middle"},r=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"圖片"),(0,s._)("th",null,"商品名稱"),(0,s._)("th",null,"價格"),(0,s._)("th",null,"數量"),(0,s._)("th")])],-1),c={style:{width:"200px"}},p=["onClick"],h={key:0,class:"h5"},g={key:1,class:"h6"},b={key:2,class:"h5"},_={class:"btn-toolbar justify-content-between",role:"toolbar","aria-label":"Toolbar with button groups"},y={class:"btn-group",role:"group","aria-label":"First group"},k=["onClick"],m=["onUpdate:modelValue"],w=["onClick"],v={class:"btn-group btn-group-sm"},C=["onClick"],f=(0,s._)("i",{class:"bi bi-three-dots"},null,-1),q=[f],D=["disabled","onClick"],x={key:0,class:"spinner-grow text-danger spinner-grow-sm",role:"status"},$=(0,s._)("span",{class:"visually-hidden"},"Loading...",-1),z=[$],I=(0,s._)("i",{class:"bi bi-cart-plus"},null,-1),P={class:"col-md-5"},U={class:"table align-middle"},L=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"品名"),(0,s._)("th",null,"單價"),(0,s._)("th",null,"數量"),(0,s._)("th")])],-1),V={class:"h5"},Q={class:"h5"},j={class:"btn-toolbar justify-content-between",role:"toolbar","aria-label":"Toolbar with button groups"},H={class:"btn-group",role:"group","aria-label":"First group"},M=["onChange","disabled","onUpdate:modelValue"],S=["onClick"],T=(0,s._)("i",{class:"bi bi-trash3"},null,-1),Y=[T],F={key:0,class:"text-end h5",style:{color:"#42b840"}},K={class:"text-end h5"},W={key:0,class:"text-end h5",style:{color:"#42b840"}},Z={class:"btn-toolbar mb-3",role:"toolbar","aria-label":"Toolbar with button groups"},A={class:"input-group"};function B(t,o,l,f,$,T){const B=(0,s.up)("LoadingComponent");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(B,{active:t.isLoading},null,8,["active"]),(0,s._)("div",n,[(0,s._)("div",i,[(0,s._)("div",d,[(0,s._)("table",u,[r,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)($.products,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",c,[(0,s._)("div",{style:(0,a.j5)([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),(0,s._)("td",null,[(0,s._)("a",{class:"text-dark",onClick:o=>T.getProduct(t.id)},(0,a.zw)(t.title),9,p)]),(0,s._)("td",null,[t.price?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",h,(0,a.zw)(t.origin_price)+" 元",1)),t.price?((0,s.wg)(),(0,s.iD)("del",g,"原價 "+(0,a.zw)(t.origin_price)+" 元",1)):(0,s.kq)("",!0),t.price?((0,s.wg)(),(0,s.iD)("div",b,"現在只要 "+(0,a.zw)(t.price)+" 元",1)):(0,s.kq)("",!0)]),(0,s._)("td",null,[(0,s._)("div",_,[(0,s._)("div",y,[(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:o=>T.deleteQty(t)},"-",8,k),(0,s.wy)((0,s._)("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>t.qty=o},null,8,m),[[e.nr,t.qty]]),(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:o=>T.addQty(t)},"+",8,w)])])]),(0,s._)("td",null,[(0,s._)("div",v,[(0,s._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:o=>T.getProduct(t.id)},q,8,C),(0,s._)("button",{type:"button",class:"btn btn-outline-danger",disabled:this.status.loadingItem===t.id,onClick:o=>T.addCart(t.id,t.qty)},[this.status.loadingItem===t.id?((0,s.wg)(),(0,s.iD)("div",x,z)):(0,s.kq)("",!0),I],8,D)])])])))),128))])])]),(0,s._)("div",P,[(0,s._)("table",U,[L,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)($.carts,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",null,[(0,s._)("a",V,(0,a.zw)(t.product.title),1)]),(0,s._)("td",null,[(0,s._)("div",Q,(0,a.zw)(t.product.price)+" 元",1)]),(0,s._)("td",null,[(0,s._)("div",j,[(0,s._)("div",H,[(0,s.wy)((0,s._)("input",{type:"number",min:"1",onChange:o=>T.updateCart(t),disabled:t.id===$.status.loadingItem,class:"form-control","onUpdate:modelValue":o=>t.qty=o},null,40,M),[[e.nr,t.qty]])])])]),(0,s._)("td",null,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>T.deleteProduct(t.id)},Y,8,S)])])))),128))]),(0,s._)("div",null,[!0===t.onDiscount?((0,s.wg)(),(0,s.iD)("p",F,"已套用折扣")):(0,s.kq)("",!0)])]),(0,s._)("div",null,[(0,s._)("p",K,"總計："+(0,a.zw)($.order.total),1)]),(0,s._)("div",null,[!0===t.onDiscount?((0,s.wg)(),(0,s.iD)("p",W,"折扣後價格："+(0,a.zw)($.order.final_total),1)):(0,s.kq)("",!0)]),(0,s._)("div",Z,[(0,s._)("div",A,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[0]||(o[0]=t=>$.coupon=t)},null,512),[[e.nr,$.coupon]]),(0,s._)("button",{type:"button",onClick:o[1]||(o[1]=t=>T.addCoupon()),class:"btn btn-outline-secondary"},"套用優惠券")])])])])])],64)}l(560);var E={data(){return{products:[],product:{},carts:[],order:{},status:{loadingItem:"",onDiscount:!1},coupon:""}},methods:{getProducts(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/products/all";this.isLoading=!0,this.$http.get(t).then((t=>{this.products=t.data.products.filter(((t,o,l)=>(t.qty=0,t))),console.log("products:",this.products),this.isLoading=!1}))},getProduct(t){this.$router.push(`/user/product/${t}`)},addCart(t,o){const l="https://vue3-course-api.hexschool.io/api/yufang-api/cart";this.status.loadingItem=t;const s={product_id:t,qty:0===o?1:o};this.$http.post(l,{data:s}).then((t=>{this.status.loadingItem="",this.getCart()})),console.log("item.id:",t,"item.qty:",o)},addQty(t){t.qty+=1},deleteQty(t){t.qty>0&&(t.qty-=1)},getCart(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/cart";this.$http.get(t).then((t=>{console.log("getCart:",t.data.data),this.carts=t.data.data.carts,this.order=t.data.data}))},deleteProduct(t){const o=`https://vue3-course-api.hexschool.io/api/yufang-api/cart/${t}`;this.$http.delete(o).then((t=>{this.$httpMessageState(t,"刪除"),this.getCart()}))},updateCart(t){const o=`https://vue3-course-api.hexschool.io/api/yufang-api/cart/${t.id}`;this.status.loadingItem=t.id;const l={product_id:t.id,qty:t.qty};this.$http.put(o,{data:l}).then((t=>{console.log(t.data),this.status.loadingItem="",this.getCart()}))},addCoupon(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/coupon",o={code:this.coupon};this.$http.post(t,{data:o}).then((t=>{console.log(t),t.data.success?(this.getCart(),this.onDiscount=!0,this.coupon="",this.$httpMessageState(t)):this.$httpMessageState(t)}))}},created(){this.getProducts(),this.getCart()}},G=l(89);const J=(0,G.Z)(E,[["render",B]]);var N=J}}]);
//# sourceMappingURL=159.f8e003e0.js.map