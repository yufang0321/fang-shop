"use strict";(self["webpackChunkfang_shop"]=self["webpackChunkfang_shop"]||[]).push([[819],{819:function(t,e,l){l.r(e),l.d(e,{default:function(){return dt}});var o=l(3396),a=l(7139),s=l(9242);const n={class:"container"},i={class:"row mt-4"},r={class:"col-md-7"},d={class:"table align-middle"},u=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"圖片"),(0,o._)("th",null,"商品名稱"),(0,o._)("th",null,"價格"),(0,o._)("th",null,"數量"),(0,o._)("th")])],-1),c={style:{width:"200px"}},p=["onClick"],h={key:0,class:"h5"},b={key:1,class:"h6"},m={key:2,class:"h5"},g={class:"btn-toolbar justify-content-between",role:"toolbar","aria-label":"Toolbar with button groups"},_={class:"btn-group",role:"group","aria-label":"First group"},y=["onClick"],f=["onUpdate:modelValue"],v=["onClick"],w={class:"btn-group btn-group-sm"},k=["onClick"],C=(0,o._)("i",{class:"bi bi-three-dots"},null,-1),q=[C],x=["disabled","onClick"],D={key:0,class:"spinner-grow text-danger spinner-grow-sm",role:"status"},$=(0,o._)("span",{class:"visually-hidden"},"Loading...",-1),U=[$],V=(0,o._)("i",{class:"bi bi-cart-plus"},null,-1),z={class:"col-md-5"},I={class:"table align-middle"},P=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"品名"),(0,o._)("th",null,"單價"),(0,o._)("th",null,"數量"),(0,o._)("th")])],-1),L={class:"h5"},j={class:"h5"},M={class:"btn-toolbar justify-content-between",role:"toolbar","aria-label":"Toolbar with button groups"},Q={class:"btn-group",role:"group","aria-label":"First group"},H=["onChange","disabled","onUpdate:modelValue"],O=["onClick"],S=(0,o._)("i",{class:"bi bi-trash3"},null,-1),T=[S],Y={key:0,class:"text-end h5",style:{color:"#42b840"}},E={class:"text-end h5"},F={key:0,class:"text-end h5",style:{color:"#42b840"}},K={class:"btn-toolbar mb-3",role:"toolbar","aria-label":"Toolbar with button groups"},W={class:"input-group"},Z={class:"my-5 row justify-content-center"},A={class:"col-md-6"},B={class:"mb-3"},G=(0,o._)("label",{for:"email",class:"form-label"},"Email",-1),J={class:"mb-3"},N=(0,o._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),R={class:"mb-3"},X=(0,o._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),tt={class:"mb-3"},et=(0,o._)("label",{for:"address",class:"form-label"},"收件人地址",-1),lt={class:"mb-3"},ot=(0,o._)("label",{for:"message",class:"form-label"},"留言",-1),at={class:"text-end"};function st(t,e,l,C,$,S){const st=(0,o.up)("LoadingComponent");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(st,{active:t.isLoading},null,8,["active"]),(0,o._)("div",n,[(0,o._)("div",i,[(0,o._)("div",r,[(0,o._)("table",d,[u,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)($.products,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",c,[(0,o._)("div",{style:(0,a.j5)([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),(0,o._)("td",null,[(0,o._)("a",{class:"text-dark",onClick:e=>S.getProduct(t.id)},(0,a.zw)(t.title),9,p)]),(0,o._)("td",null,[t.price?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",h,(0,a.zw)(t.origin_price)+" 元",1)),t.price?((0,o.wg)(),(0,o.iD)("del",b,"原價 "+(0,a.zw)(t.origin_price)+" 元",1)):(0,o.kq)("",!0),t.price?((0,o.wg)(),(0,o.iD)("div",m,"現在只要 "+(0,a.zw)(t.price)+" 元",1)):(0,o.kq)("",!0)]),(0,o._)("td",null,[(0,o._)("div",g,[(0,o._)("div",_,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>S.deleteQty(t)},"-",8,y),(0,o.wy)((0,o._)("input",{type:"number",min:"1",class:"form-control","onUpdate:modelValue":e=>t.qty=e},null,8,f),[[s.nr,t.qty]]),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>S.addQty(t)},"+",8,v)])])]),(0,o._)("td",null,[(0,o._)("div",w,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>S.getProduct(t.id)},q,8,k),(0,o._)("button",{type:"button",class:"btn btn-outline-danger",disabled:this.status.loadingItem===t.id,onClick:e=>S.addCart(t.id,t.qty)},[this.status.loadingItem===t.id?((0,o.wg)(),(0,o.iD)("div",D,U)):(0,o.kq)("",!0),V],8,x)])])])))),128))])])]),(0,o._)("div",z,[(0,o._)("table",I,[P,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)($.carts,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",null,[(0,o._)("a",L,(0,a.zw)(t.product.title),1)]),(0,o._)("td",null,[(0,o._)("div",j,(0,a.zw)(t.product.price)+" 元",1)]),(0,o._)("td",null,[(0,o._)("div",M,[(0,o._)("div",Q,[(0,o.wy)((0,o._)("input",{type:"number",min:"1",onChange:e=>S.updateCart(t),disabled:t.id===$.status.loadingItem,class:"form-control","onUpdate:modelValue":e=>t.qty=e},null,40,H),[[s.nr,t.qty]])])])]),(0,o._)("td",null,[(0,o._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>S.deleteProduct(t.id)},T,8,O)])])))),128))]),(0,o._)("div",null,[!0===t.onDiscount?((0,o.wg)(),(0,o.iD)("p",Y,"已套用折扣")):(0,o.kq)("",!0)])]),(0,o._)("div",null,[(0,o._)("p",E,"總計："+(0,a.zw)($.order.total),1)]),(0,o._)("div",null,[!0===t.onDiscount?((0,o.wg)(),(0,o.iD)("p",F,"折扣後價格："+(0,a.zw)($.order.final_total),1)):(0,o.kq)("",!0)]),(0,o._)("div",K,[(0,o._)("div",W,[(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[0]||(e[0]=t=>$.coupon=t)},null,512),[[s.nr,$.coupon]]),(0,o._)("button",{type:"button",onClick:e[1]||(e[1]=t=>S.addCoupon()),class:"btn btn-outline-secondary"},"套用優惠券")])])])])]),(0,o._)("div",Z,[(0,o._)("div",A,[(0,o._)("div",B,[G,(0,o.wy)((0,o._)("input",{id:"email",name:"email",type:"email",class:"form-control",placeholder:"請輸入 Email",rules:"email|required","onUpdate:modelValue":e[2]||(e[2]=t=>$.form.user.email=t)},null,512),[[s.nr,$.form.user.email]])]),(0,o._)("div",J,[N,(0,o.wy)((0,o._)("input",{id:"name",name:"姓名",type:"text",class:"form-control",placeholder:"請輸入姓名",rules:"required","onUpdate:modelValue":e[3]||(e[3]=t=>$.form.user.name=t)},null,512),[[s.nr,$.form.user.name]])]),(0,o._)("div",R,[X,(0,o.wy)((0,o._)("input",{id:"tel",name:"電話",type:"tel",class:"form-control",placeholder:"請輸入電話",rules:"required","onUpdate:modelValue":e[4]||(e[4]=t=>$.form.user.tel=t)},null,512),[[s.nr,$.form.user.tel]])]),(0,o._)("div",tt,[et,(0,o.wy)((0,o._)("input",{id:"address",name:"地址",type:"text",class:"form-control",placeholder:"請輸入地址",rules:"required","onUpdate:modelValue":e[5]||(e[5]=t=>$.form.user.address=t)},null,512),[[s.nr,$.form.user.address]])]),(0,o._)("div",lt,[ot,(0,o.wy)((0,o._)("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[6]||(e[6]=t=>$.form.message=t)},null,512),[[s.nr,$.form.message]])]),(0,o._)("div",at,[(0,o._)("button",{class:"btn btn-danger",onClick:e[7]||(e[7]=(0,s.iM)((t=>S.createOrder()),["prevent"]))},"送出訂單")])])])],64)}l(560);var nt={data(){return{products:[],product:{},carts:[],order:{},status:{loadingItem:"",onDiscount:!1},coupon:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getProducts(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/products/all";this.isLoading=!0,this.$http.get(t).then((t=>{this.products=t.data.products.filter(((t,e,l)=>(t.qty=1,t))),console.log("products:",this.products),this.isLoading=!1}))},getProduct(t){this.$router.push(`/user/product/${t}`)},addCart(t,e){const l="https://vue3-course-api.hexschool.io/api/yufang-api/cart";this.status.loadingItem=t;const o={product_id:t,qty:0===e?1:e};this.$http.post(l,{data:o}).then((t=>{this.status.loadingItem="",this.getCart()})),console.log("item.id:",t,"item.qty:",e)},addQty(t){t.qty+=1},deleteQty(t){t.qty>1&&(t.qty-=1)},getCart(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/cart";this.$http.get(t).then((t=>{console.log("getCart:",t.data.data),this.carts=t.data.data.carts,this.order=t.data.data}))},deleteProduct(t){const e=`https://vue3-course-api.hexschool.io/api/yufang-api/cart/${t}`;this.$http.delete(e).then((t=>{this.$httpMessageState(t,"刪除"),this.getCart()}))},updateCart(t){const e=`https://vue3-course-api.hexschool.io/api/yufang-api/cart/${t.id}`;this.status.loadingItem=t.id;const l={product_id:t.id,qty:t.qty};this.$http.put(e,{data:l}).then((t=>{console.log(t.data),this.status.loadingItem="",this.getCart()}))},addCoupon(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/coupon",e={code:this.coupon};this.$http.post(t,{data:e}).then((t=>{console.log(t),t.data.success?(this.getCart(),this.onDiscount=!0,this.coupon="",this.$httpMessageState(t)):this.$httpMessageState(t)}))},createOrder(){const t="https://vue3-course-api.hexschool.io/api/yufang-api/order",e=this.form;this.$http.post(t,{data:e}).then((t=>{console.log("createOrder------\x3e",t)}))}},created(){this.getProducts(),this.getCart()}},it=l(89);const rt=(0,it.Z)(nt,[["render",st]]);var dt=rt}}]);
//# sourceMappingURL=819.5ba3907a.js.map